{% extends "base.html" %}

{% block title %}Advanced Trading Dashboard - AI Trading System{% endblock %}

{% block head %}
<style>
    body {
        background: #0a0a0a;
        color: #e0e0e0;
        font-family: 'Arial', sans-serif;
    }
    
    .dashboard-container {
        display: grid;
        grid-template-columns: 250px 1fr;
        height: 100vh;
        gap: 10px;
        padding: 10px;
    }
    
    /* Control Panel Sidebar */
    .control-panel {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        border-radius: 10px;
        padding: 20px;
        overflow-y: auto;
    }
    
    .control-section {
        margin-bottom: 25px;
        padding: 15px;
        background: rgba(255,255,255,0.05);
        border-radius: 8px;
    }
    
    .control-section h5 {
        color: #00ff88;
        margin-bottom: 15px;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    /* Main Content Area */
    .main-content {
        display: grid;
        grid-template-rows: 60px 1fr;
        gap: 10px;
    }
    
    /* Status Bar */
    .status-bar {
        background: linear-gradient(90deg, #1a1a2e 0%, #0f3460 100%);
        border-radius: 10px;
        padding: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .status-item {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        animation: pulse 2s infinite;
    }
    
    .status-indicator.active {
        background: #00ff00;
        box-shadow: 0 0 10px #00ff00;
    }
    
    .status-indicator.inactive {
        background: #ff0000;
        box-shadow: 0 0 10px #ff0000;
    }
    
    /* Trading Grid */
    .trading-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        grid-template-rows: 1fr 1fr;
        gap: 10px;
        height: 100%;
    }
    
    .panel {
        background: #1a1a2e;
        border-radius: 10px;
        padding: 20px;
        position: relative;
        overflow: hidden;
    }
    
    .panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }
    
    .panel-title {
        color: #00ff88;
        font-size: 16px;
        font-weight: bold;
    }
    
    /* Neural Network Visualization */
    .neural-network-container {
        grid-row: span 2;
    }
    
    #neural-network-viz {
        width: 100%;
        height: calc(100% - 40px);
        background: radial-gradient(ellipse at center, #0a0a1a 0%, #000 100%);
        border-radius: 8px;
    }
    
    /* Performance Metrics */
    .metric-card {
        background: rgba(255,255,255,0.05);
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
    }
    
    .metric-value {
        font-size: 24px;
        font-weight: bold;
        color: #00ff88;
    }
    
    .metric-label {
        font-size: 12px;
        color: #888;
        text-transform: uppercase;
    }
    
    /* Indicator Selection */
    .indicator-list {
        max-height: 300px;
        overflow-y: auto;
    }
    
    .indicator-item {
        display: flex;
        align-items: center;
        padding: 8px;
        margin-bottom: 5px;
        background: rgba(255,255,255,0.05);
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .indicator-item:hover {
        background: rgba(0,255,136,0.1);
    }
    
    .indicator-item.selected {
        background: rgba(0,255,136,0.2);
        border: 1px solid #00ff88;
    }
    
    /* Neural Network Controls */
    .nn-control {
        margin-bottom: 15px;
    }
    
    .nn-control label {
        display: block;
        margin-bottom: 5px;
        font-size: 12px;
        color: #aaa;
    }
    
    .nn-control input[type="range"] {
        width: 100%;
        height: 6px;
        background: #333;
        outline: none;
        -webkit-appearance: none;
        border-radius: 3px;
    }
    
    .nn-control input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 16px;
        height: 16px;
        background: #00ff88;
        border-radius: 50%;
        cursor: pointer;
    }
    
    .nn-control-value {
        text-align: right;
        color: #00ff88;
        font-weight: bold;
    }
    
    /* Real-time Charts */
    .chart-container {
        position: relative;
        height: 100%;
    }
    
    /* Training Progress */
    .training-progress {
        margin-top: 20px;
    }
    
    .progress-bar {
        height: 20px;
        background: #333;
        border-radius: 10px;
        overflow: hidden;
    }
    
    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #00ff88 0%, #00cc66 100%);
        transition: width 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #000;
        font-weight: bold;
        font-size: 12px;
    }
    
    /* Action Buttons */
    .btn-primary {
        background: linear-gradient(135deg, #00ff88 0%, #00cc66 100%);
        border: none;
        color: #000;
        font-weight: bold;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,255,136,0.3);
    }
    
    .btn-danger {
        background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
        border: none;
        color: #fff;
        font-weight: bold;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    /* Trade History */
    .trade-list {
        max-height: 300px;
        overflow-y: auto;
    }
    
    .trade-item {
        display: flex;
        justify-content: space-between;
        padding: 10px;
        margin-bottom: 5px;
        background: rgba(255,255,255,0.05);
        border-radius: 4px;
        font-size: 14px;
    }
    
    .trade-item.profit {
        border-left: 3px solid #00ff88;
    }
    
    .trade-item.loss {
        border-left: 3px solid #ff4444;
    }
    
    /* Optimization Panel */
    .optimization-controls {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
    }
    
    /* Live Data Stream */
    .data-stream {
        font-family: 'Courier New', monospace;
        font-size: 12px;
        background: #000;
        padding: 10px;
        border-radius: 5px;
        height: 150px;
        overflow-y: auto;
        color: #00ff00;
    }
    
    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Control Panel Sidebar -->
    <div class="control-panel">
        <!-- Training Control -->
        <div class="control-section">
            <h5><i class="fas fa-play-circle"></i> Training Control</h5>
            <button id="startTraining" class="btn btn-primary w-100 mb-2">
                <i class="fas fa-play"></i> Start Training
            </button>
            <button id="pauseTraining" class="btn btn-warning w-100 mb-2" disabled>
                <i class="fas fa-pause"></i> Pause
            </button>
            <button id="stopTraining" class="btn btn-danger w-100" disabled>
                <i class="fas fa-stop"></i> Stop
            </button>
            
            <div class="training-progress">
                <div class="metric-label">Training Progress</div>
                <div class="progress-bar">
                    <div id="trainingProgress" class="progress-fill" style="width: 0%">0%</div>
                </div>
                <small class="text-muted">Episode: <span id="currentEpisode">0</span> / <span id="totalEpisodes">1000</span></small>
            </div>
        </div>
        
        <!-- Neural Network Configuration -->
        <div class="control-section">
            <h5><i class="fas fa-brain"></i> Neural Network</h5>
            
            <div class="nn-control">
                <label>Hidden Layers: <span class="nn-control-value" id="hiddenLayersValue">3</span></label>
                <input type="range" id="hiddenLayers" min="1" max="10" value="3" step="1">
            </div>
            
            <div class="nn-control">
                <label>Neurons per Layer: <span class="nn-control-value" id="neuronsValue">128</span></label>
                <input type="range" id="neuronsPerLayer" min="32" max="512" value="128" step="32">
            </div>
            
            <div class="nn-control">
                <label>Learning Rate: <span class="nn-control-value" id="learningRateValue">0.001</span></label>
                <input type="range" id="learningRate" min="0.0001" max="0.01" value="0.001" step="0.0001">
            </div>
            
            <div class="nn-control">
                <label>Dropout Rate: <span class="nn-control-value" id="dropoutValue">0.2</span></label>
                <input type="range" id="dropoutRate" min="0" max="0.5" value="0.2" step="0.05">
            </div>
            
            <div class="nn-control">
                <label>Batch Size: <span class="nn-control-value" id="batchSizeValue">64</span></label>
                <input type="range" id="batchSize" min="16" max="256" value="64" step="16">
            </div>
        </div>
        
        <!-- Indicator Selection -->
        <div class="control-section">
            <h5><i class="fas fa-chart-line"></i> Technical Indicators</h5>
            <div class="indicator-list">
                <div class="indicator-item selected" data-indicator="sma">
                    <input type="checkbox" checked> &nbsp; SMA (Simple Moving Average)
                </div>
                <div class="indicator-item selected" data-indicator="ema">
                    <input type="checkbox" checked> &nbsp; EMA (Exponential MA)
                </div>
                <div class="indicator-item selected" data-indicator="rsi">
                    <input type="checkbox" checked> &nbsp; RSI (Relative Strength)
                </div>
                <div class="indicator-item selected" data-indicator="macd">
                    <input type="checkbox" checked> &nbsp; MACD
                </div>
                <div class="indicator-item" data-indicator="bb">
                    <input type="checkbox"> &nbsp; Bollinger Bands
                </div>
                <div class="indicator-item" data-indicator="stoch">
                    <input type="checkbox"> &nbsp; Stochastic Oscillator
                </div>
                <div class="indicator-item" data-indicator="atr">
                    <input type="checkbox"> &nbsp; ATR (Average True Range)
                </div>
                <div class="indicator-item" data-indicator="obv">
                    <input type="checkbox"> &nbsp; OBV (On Balance Volume)
                </div>
                <div class="indicator-item" data-indicator="vwap">
                    <input type="checkbox"> &nbsp; VWAP
                </div>
                <div class="indicator-item" data-indicator="ichimoku">
                    <input type="checkbox"> &nbsp; Ichimoku Cloud
                </div>
            </div>
        </div>
        
        <!-- Optimization -->
        <div class="control-section">
            <h5><i class="fas fa-cogs"></i> Optimization</h5>
            <div class="optimization-controls">
                <button class="btn btn-primary btn-sm">
                    <i class="fas fa-magic"></i> Auto-Optimize
                </button>
                <button class="btn btn-primary btn-sm">
                    <i class="fas fa-dna"></i> Genetic Algorithm
                </button>
                <button class="btn btn-primary btn-sm">
                    <i class="fas fa-chart-bar"></i> Grid Search
                </button>
                <button class="btn btn-primary btn-sm">
                    <i class="fas fa-random"></i> Random Search
                </button>
            </div>
        </div>
        
        <!-- Timeframe Selection -->
        <div class="control-section">
            <h5><i class="fas fa-clock"></i> Timeframe</h5>
            <select id="timeframeSelect" class="form-control">
                <option value="1">1 minute</option>
                <option value="2">2 minutes</option>
                <option value="3">3 minutes</option>
                <option value="5" selected>5 minutes</option>
                <option value="10">10 minutes</option>
                <option value="15">15 minutes</option>
                <option value="20">20 minutes</option>
                <option value="30">30 minutes</option>
                <option value="60">60 minutes</option>
                <option value="120">120 minutes</option>
                <option value="240">240 minutes</option>
            </select>
        </div>
    </div>
    
    <!-- Main Content Area -->
    <div class="main-content">
        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-item">
                <span class="status-indicator active"></span>
                <span>AI System: <strong id="aiStatus">ONLINE</strong></span>
            </div>
            <div class="status-item">
                <span>Training Mode: <strong id="trainingMode">LIVE</strong></span>
            </div>
            <div class="status-item">
                <span>Model: <strong id="modelType">ANE-PPO</strong></span>
            </div>
            <div class="status-item">
                <span>GPU Status: <strong id="gpuStatus">4x RTX 3090</strong></span>
            </div>
            <div class="status-item">
                <span>Market: <strong>NQ FUTURES</strong></span>
            </div>
        </div>
        
        <!-- Trading Grid -->
        <div class="trading-grid">
            <!-- Neural Network Visualization -->
            <div class="panel neural-network-container">
                <div class="panel-header">
                    <h3 class="panel-title">
                        <i class="fas fa-network-wired"></i> Neural Network Activity
                    </h3>
                    <button class="btn btn-sm btn-primary">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
                <canvas id="neural-network-viz"></canvas>
            </div>
            
            <!-- Performance Metrics -->
            <div class="panel">
                <div class="panel-header">
                    <h3 class="panel-title">
                        <i class="fas fa-chart-pie"></i> Performance Metrics
                    </h3>
                </div>
                
                <div class="metric-card">
                    <div class="metric-value" id="winRate">0%</div>
                    <div class="metric-label">Win Rate</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-value" id="sharpeRatio">0.00</div>
                    <div class="metric-label">Sharpe Ratio</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-value" id="totalProfit">$0</div>
                    <div class="metric-label">Total Profit</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-value" id="maxDrawdown">0%</div>
                    <div class="metric-label">Max Drawdown</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-value" id="totalTrades">0</div>
                    <div class="metric-label">Total Trades</div>
                </div>
            </div>
            
            <!-- Real-time Training Chart -->
            <div class="panel">
                <div class="panel-header">
                    <h3 class="panel-title">
                        <i class="fas fa-chart-line"></i> Training Performance
                    </h3>
                </div>
                <canvas id="trainingChart" style="height: calc(100% - 40px);"></canvas>
            </div>
            
            <!-- Live Data & Trades -->
            <div class="panel">
                <div class="panel-header">
                    <h3 class="panel-title">
                        <i class="fas fa-stream"></i> Live Data Stream
                    </h3>
                </div>
                
                <div class="data-stream" id="dataStream">
                    Waiting for data...
                </div>
                
                <h5 class="mt-3 text-white">Recent Trades</h5>
                <div class="trade-list" id="tradeList">
                    <!-- Trades will be populated here -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Hidden elements for compatibility -->
<div style="display: none;">
    <div id="recent-trades-list"></div>
    <div id="no-trades-message"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="/static/js/enhanced_trading.js"></script>
{% endblock %}